<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Cartoony MMA — Desktop Test (v13)</title>
<meta name="theme-color" content="#0b132a">
<style>
  :root{--bg:#0a0f1e;--panel:#0f172a;--line:#1f2a3c;--text:#e2e8f0;--btn:64px;--pad:12px}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;overflow:hidden}
  #wrap{display:flex;flex-direction:column;height:100vh}
  header{padding:10px 14px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0f172a,#0b1322);display:flex;gap:10px;align-items:center}
  h1{margin:0;font-size:16px;flex:1}
  #gameArea{flex:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
  #game{display:block;max-width:100vw;max-height:100%}
  #hudBar{position:absolute;top:8px;left:50%;transform:translateX(-50%);z-index:8;display:flex;align-items:center;gap:12px}
  .hudShell{width:min(40vw,400px);height:22px;background:#0b1220;border-radius:18px;border:2px solid #0f1a2b;box-shadow: inset 0 6px 14px rgba(0,0,0,.45)}
  .hudFill{height:100%;border-radius:16px;margin:2px;box-shadow: inset 0 -4px 8px rgba(0,0,0,.35)}
  #hp1{background:linear-gradient(90deg,#22c55e,#86efac)} #hp2{background:linear-gradient(90deg,#f97316,#f59e0b)}
  #instr{position:absolute;top:40px;right:14px;background:#0f172a;border:1px solid #1f2a3c;border-radius:10px;padding:8px 10px;font-size:13px;opacity:.92}
  #controls{position:absolute;inset:0;pointer-events:none}
  .cluster{position:absolute;bottom:18px;display:grid;gap:var(--pad);pointer-events:auto}
  #leftCluster{left:18px;grid-template-columns:repeat(2,var(--btn));grid-auto-rows:var(--btn);}
  #rightCluster{right:18px;grid-template-columns:repeat(2,var(--btn));grid-auto-rows:var(--btn);}
  .btn{width:var(--btn);height:var(--btn);border-radius:12px;border:1px solid #2a155c;background:linear-gradient(180deg,#5b35b1,#341d73);color:#e8e4ff;font-weight:800;
        text-shadow:0 2px 0 rgba(0,0,0,.45); user-select:none; cursor:pointer}
  .btn small{display:block;font-size:11px;opacity:.9;margin-top:2px}
  .face{position:absolute;top:10px;left:10px;display:flex;gap:10px;align-items:center}
  .face img{width:44px;height:44px;border-radius:50%;border:2px solid #1f2a3c}
</style>
</head>
<body>
<div id="wrap">
  <header><h1>Cartoony MMA — Desktop Test (v13)</h1></header>
  <div id="gameArea">
    <canvas id="game" width="1280" height="720" aria-label="game canvas"></canvas>
    <div id="hudBar" aria-hidden="true">
      <div class="hudShell"><div id="hp1" class="hudFill" style="width:100%"></div></div>
      <div id="roundLabel">Round 1</div>
      <div class="hudShell"><div id="hp2" class="hudFill" style="width:100%"></div></div>
    </div>
    <div id="instr">Controls:<br>Left/Right buttons move<br><b>Z</b>=Punch, <b>X</b>=Block (hold), <b>C</b>=Kick, <b>V</b>=Jump</div>
    <div class="face"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAHL0lEQVR42u3d71MVVRzH8e8uPwREUfztMJo/GRXDq42joxljiYaBmqF/RI961vSgh/4vYpqmpqam1pg1FUpKGDRq+WOUYYRQQYHL7UlNCbi75+459+7ueX8e32Xu/fry+z27nHMRIYSQuMShBP9l5vzlmbA/o+dBJzW1FZYOQIADVl4g2Q7NARLQgGUY09q6T0K/j9aLB0CWBFjZgNIBKBfg4gzMsQFTPiDphhY3ZE5SQUURkw5kcQHmJAlUnDCFRRZ1YE7cQSUBUxhkUQXmxBVVkkGpAosiLgdQAEs8LC9UNoNSARYVXA6gAGYiLqjiG6/65PvXWk4UUQFKX/fKV+dyogQKVMkZjU5UUAEqWd3LBZU9a69crrtcUIErtqNwog8DqPyORtNj0QWVnd3LdOdyQQWuWMECld24XFCBywQuF1TgMoHLBRW4TOByQQUuE7jcXL5pEg9ckYEVx5PHxOy/p2viTdCtGIkuqIgJXK7pN0fsXG9lDYt1Fest7bAYgYzEnIxCUDESQ8NiBDIStcNiBDISczIKQcVIDA2LEUhUHLj50EyS37VcnUoJXStUx6Jb0bVCw6JbkWxcuLnQS+zrWoVx/rBN21fL/l1rQ/2MgcEh+ejTI/L02Qut7625KSW7d7ye1bUfftwiff2DsYboqrS7JHarstJiaayvoSVl0bW8xqFLuUTq61bI9IoyCpGLjmXTor24qED2NNSiQeMiPnDHSvqivW7TMpkzawpSNDlgFP6TAteR5sYUhTA5Cm19drVh3SJZWFWJCg3jMFDHsuXZleOI7Guia+nwwCgckzU1VVK9ZDaFMHVXaHP2715HEXTDsuGhqF+ql8yWVE0VOhTG4Vg3dKxXZF9TShyHOjAKNWdBVaVsXLeIQgBLfz5oTEmBS9sKDYv11cuZM2uK1G1ahpIs1ll0LJ/saaiV4qICCsEo1JvpFWVSX7eCQgBLfxrra6SstJhCAMs/GYXfhpZPniQ7t61CC7D88/3Pt5Ve/+7WlVIxtRQxqrBsuyM8ea5daZ/7pOLCrPew23hnaG3HGhgckuNf3VC6Zuvm5TJrRjmaGIXeOXOxQ3r7BgK/vrDQlb3vrUENsLwzPJyWI1+2KV2zef1iqZo3DTnA8s6l77rkYXd/4Nc7jiPNbAYEll/Soxn57MQ1pWveqF0gS1+biR5g+T96+OPeY6Vr2AwILN9kMiIHj7UqXbNy+VxZvWI+xQOWd9ra78vN3x8pXbOvaS2FA5Z/Dh5V61qLF86Q9amFFA5Y3um81S1Xr99Tuqa5MSUumwGB5ZeWL1olo/Ab6vlzK+TNDUspHLC88+f9Xrnyk9ovqPc21EpRIZsBgeWTQ8evSTo9Gvj1Myony9tbqikcsLzT3fNELlzuUrpm147VUlJSRPGA5Z3PT7XJ0NBI4NdPLS+Rhq0rKRywvNP316CcvtChdE3DO6tkSvkkivd/WD0POl+6Z269eMD64pw4e0MGBocCv760pEiattu1GXCsk38d0bE88mxAfTPgti3VUjmN7zMFlk9OX+hQ+mrsoqICeX/nGmBBxztDQyNyVHEz4Fsbl8q82VOBRbzz9eUu6e55EryoriPrU68Bi3gnnR6Vw4qbAW3/CiR3ohU9d4bjc/nH23L3QS+FCHBHSMdSSCaTkZZjVykEo9DA/9Drd6XzVjeFAJb+tChuYQYW66xA6eh6JG2/3qd7e6yv6FghulaGvzvLKNSdO3cfyw+tdyhEWFiMw/E5dPyqpEftbFtBPEwIa+y8JOPzsLtfvrnSRSFe4YVRGCKHT7bJ8HCaQoRZYzEOx6e3b0DOXrrJGFSBxTgMlmNnrsvg82HGIKNQb54+eyEnz7VTCBVYPCwNllPn26X/yXPrxqDXVKNjacjzFyNy9PQvFCIMLLrWxDn/7W/S8/ip9Yv2wLBYxAfLyMioHD7RZs3n9XMRCM1Ef6Xc9r8MZvsjBj9Yrg6dhEcM2hbvrLXs7VZaF+90LaLiwM2HZpLsbqUMayKt4GLBrqVjMRIZgcZHIV2LEagVFiOREWisYzESGYHGRyFdixGoFRYjkRForGOBC1TGRiHrLdZVRtdYdC2711VGYDESGYHGOha4QGVsFIILVMbWWOCyG5XRxTu47EVlFBa47EVlHBa47EQlEvCUjo5MdNJHhNM+uQaVC1Q56Vh+H4bulTxUOYUFLntQ5XQUBhmLjEYzoHKNKm+wWHcls0tFBhbdK1ldKm9rLNUPz9ornqgi0bHoXskCFUlYfrhsB+bXwaO04TKyOz8BFk9QkYcVBFfSgQVZY0Z1W3gs9qoHAZYUZEFvWKJ+ziBWhyCCAosbMpW737gcXInl6RoVYFFFpvooJW4noWJ/bEsVWb6gZfNMLs7H6hJzHjAbYCbA6Xiom4Rzmok8aKoDWa6TtEO/VpxgjiK0pJ8et/JofD6g2fY1BHzngmZwfI8FIQbzN91uTwToSbvrAAAAAElFTkSuQmCC"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAEKklEQVR42u3dvW0UQRgG4N0RJUBCROSEhIDMIRIlUAApHbgAchpwAZYgBbkEy4HJEAU4cg8QIZA53e3szszOz/OmCGvv7tH3fnu+OU+TiEgrmT0Ff/P0+dmvrT/j4f6n53RUWCkAAQfWLpBGhzaDBBpYmTG9/fh683VcX9xC1gOsNaBSACoBrmVg8wiY9oCUGlpryOZeQdWIKQWyVoDNPYFqCdNWZLUDm1sH1QOmLchqBTa3iqpnULHAasQ1AwVY97COoRoZVAywWnDNQAGWIwGqdnPs+dn711pzjaiASje99ppcc02goOqnGudaUAHV1/QKUI2ze5XcuwJUcDVbhYceDFD7VmPuWgxQjTm9ck+uABVcTcGCamxcASq4cuAKUMGVA1eACq4cuAJUcOXAFUpetLSBqxpYLZ48lryvZ8hxEaaVSgxQSQ5cIffFyZj71mpY9ir7VnJYKlAlFqlCqFTiZlgqUCUmh6UCVWKRKoRKJW6GpQIlxkHYQ7P0P7VCSqViam2aWKaVqbUZlmkla1yEEnplvKn1pOUH++7V++n8xZsuX8hvP75MX398bvb6Q8y4M61MraV1GDxdUnRiWdplyxK/eGKpQYlxoAqlXBWqQdlah4smlhqUWA+qUMreFYokheVNUVlTh4/dNP0rnau7y+nq7jLZz/twfjGdPXu56v9+v7+ZLm8+EacKBSxpG5b9SlLtWSaWqEIBS8ASAUtag+WOUFLeGZpYogoFLAFLBCwBS8ASAUvAErBEwBKwBCwRsAQsAUskMayH+5/zv/9wfXHr2ZGTeezkjyMTS1ShgCVgiYAlLcJyZygp7ghNLFGFApbI/7DsWbJ1vzKxRBVKh7DUocR6OAjrcV+KHMshL6pQ9t2x1KHEOAgx401kqRNVKOWr0Julcuz1P9ZqJpbsu7ybWqZVUliWeFnjYhGaQ3+l3PfAjz2tTsEKKXSKaZVsebdr2a2SwDK1JMZB2EOz9D2tomEd0gqXhT3JxFKJKjB7FZpaKjApLJWoArNNLJWoArNXoamlApPCUokqMNvEgguqbFVo37JXZd2xTK2x96ossFSiCsw2seCCKlsVwgVVth0LrrFRZV3e4RoXVVZYcI2LKjssuMZENU0LT+mkyKGTPtPktE9pUCVQFZlYpx6M6dUfqqKw4BoHVdEqXFKLqjEPqNKodoNl7+pzSlUDy/Tqa0rttmPFPni7V5uoqphYpldfoKqEdQrX6MBOTfCaPnBZ7Sc/AWsTVPWwluDqHdiSHbPWj4U38Vn1JcB6Qbb0hqX2cwZNHYJYCqw1ZDF3v60cXGnydE0MsFqRxb6V0tpJqOaPbcUi2wvamvfkWj5W1815wDXAcoBL8aZuD+c0uzxomgJZ6fR26HeIE8w1Quv99PiQR+P3gDba1xD4zoXE4HyPhUjG/Ab3jGNVLDMhiwAAAABJRU5ErkJggg=="></div>
    <div id="controls">
      <div id="leftCluster" class="cluster">
        <button class="btn" id="btnLeft">Left</button>
        <button class="btn" id="btnRight">Right</button>
      </div>
      <div id="rightCluster" class="cluster">
        <button class="btn" id="btnPunch">Punch<small>Z</small></button>
        <button class="btn" id="btnBlock">Block<small>X</small></button>
        <button class="btn" id="btnKick">Kick<small>C</small></button>
        <button class="btn" id="btnJump">Jump<small>V</small></button>
      </div>
    </div>
  </div>
</div>

<script>
// Canvas fit
const DPR=Math.max(1,Math.min(2,window.devicePixelRatio||1));
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
const hp1=document.getElementById('hp1'), hp2=document.getElementById('hp2');
const state={{width:1280,height:720,arena:{{left:120,right:1160,ground:600}},t:0}};

function fitCanvas(){{ const headerH=document.querySelector('header').offsetHeight||48; const vw=window.innerWidth, vh=window.innerHeight-headerH;
  let cssW=vw, cssH=Math.round(vw*9/16); if(cssH>vh){{ cssH=vh; cssW=Math.round(cssH*16/9); }}
  canvas.style.width=cssW+'px'; canvas.style.height=cssH+'px'; canvas.width=Math.round(cssW*DPR); canvas.height=Math.round(cssH*DPR); ctx.setTransform(DPR,0,0,DPR,0,0);
  state.width=cssW; state.height=cssH; state.arena.ground=Math.round(cssH*0.86); state.arena.left=Math.round(cssW*0.06); state.arena.right=Math.round(cssW*0.94);
}} window.addEventListener('resize',fitCanvas); fitCanvas();

// Fighters
function makeF(x,dir=1,id='p'){{ return {{ x, y:state.arena.ground, vy:0, dir, onGround:true, hp:100, action:'idle', cd:0, stun:0, speed:340, jumpV: -560, id }}; }}
const p1=makeF(state.width*0.3, 1, 'player');
const p2=makeF(state.width*0.7,-1, 'cpu');

// Inputs
const input={{left:false,right:false,punch:false,kick:false,block:false,jump:false}};
const KeyMap={{ 'ArrowLeft':'left','ArrowRight':'right','z':'punch','x':'block','c':'kick','v':'jump','Z':'punch','X':'block','C':'kick','V':'jump' }};
window.addEventListener('keydown', e=>{{ if(e.repeat) return; const k=KeyMap[e.key]; if(k) input[k]=true; }});
window.addEventListener('keyup', e=>{{ const k=KeyMap[e.key]; if(k) input[k]=false; }});

// On-screen buttons (pointer events)
function bindHold(id, key){{ const el=document.getElementById(id);
  const on = e=>{{ e.preventDefault(); input[key]=true; }};
  const off= e=>{{ e.preventDefault(); input[key]=false; }};
  ['pointerdown','mousedown','touchstart'].forEach(ev=>el.addEventListener(ev,on));
  ['pointerup','pointercancel','mouseleave','mouseup','touchend','touchcancel'].forEach(ev=>el.addEventListener(ev,off));
}}
bindHold('btnLeft','left'); bindHold('btnRight','right');
bindHold('btnPunch','punch'); bindHold('btnBlock','block'); bindHold('btnKick','kick'); bindHold('btnJump','jump');

// Simple arena
function drawArena(){{const W=state.width,H=state.height;const bg=ctx.createLinearGradient(0,0,0,H);bg.addColorStop(0,'#0b132a');bg.addColorStop(1,'#0a0f1e');ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);
  const top=H*0.25, bot=state.arena.ground, pad=28, left=pad, right=W-pad; ctx.strokeStyle='#132038'; ctx.lineWidth=12; ctx.lineJoin='round';
  ctx.beginPath(); ctx.moveTo(left,top+10); ctx.lineTo(right,top+10); ctx.lineTo(right-6,bot); ctx.lineTo(left+6,bot); ctx.closePath(); ctx.stroke();
  ctx.fillStyle='rgba(255,255,255,0.06)'; ctx.beginPath(); ctx.ellipse(W*0.5,bot-6, W*0.28, 18, 0, 0, Math.PI*2); ctx.fill(); }}

// Draw fighters (simple shapes focusing on function)
function drawFighter(f,color){{
  // shadow
  ctx.fillStyle='rgba(0,0,0,0.30)'; ctx.beginPath(); ctx.ellipse(f.x, f.y-4, 24, 8, 0, 0, Math.PI*2); ctx.fill();
  // body
  ctx.fillStyle=color; ctx.strokeStyle='#0a1022'; ctx.lineWidth=3;
  ctx.beginPath(); if (ctx.roundRect) {{ ctx.roundRect(f.x-18, f.y-110, 36, 82, 10); }} else {{ ctx.rect(f.x-18, f.y-110, 36, 82); }} ctx.fill(); ctx.stroke();
  // head
  ctx.beginPath(); ctx.arc(f.x, f.y-132, 20, 0, Math.PI*2); ctx.fillStyle='#cbd5e1'; ctx.fill(); ctx.stroke();
  // stance arms (visual only)
  ctx.beginPath(); ctx.moveTo(f.x-18, f.y-95); ctx.lineTo(f.x-40, f.y-80);
  ctx.moveTo(f.x+18, f.y-95); ctx.lineTo(f.x+40, f.y-80);
  ctx.strokeStyle='#1f2a3c'; ctx.stroke();
}}

function faceEach(a,b){{ a.dir=(b.x>=a.x)?1:-1; b.dir=(a.x>=b.x)?1:-1; }}

const GRAV=1400;

// Combat helpers
const dist=(a,b)=>Math.abs(a.x-b.x);
const front=(att,def)=>Math.sign(def.x-att.x)===att.dir;
const inPunch=(a,d)=>dist(a,d)<=68 && front(a,d);
const inKick=(a,d)=>dist(a,d)<=95 && front(a,d);

function doPunch(a,d){{ a.action='punch'; a.cd=.28; if(inPunch(a,d)){{ d.hp=Math.max(0,d.hp-(d.action==='block'?6:12)); d.stun=(d.action==='block'?0.05:0.12); }} }}
function doKick(a,d){{ a.action='kick'; a.cd=.42; if(inKick(a,d)){{ d.hp=Math.max(0,d.hp-(d.action==='block'?8:16)); d.stun=(d.action==='block'?0.06:0.16); }} }}
function doBlock(a){{ a.action='block'; a.cd=0; }}
function doJump(a){{ if(a.onGround){{ a.vy = a.jumpV; a.onGround=false; }} }}

function step(me,op,dt,inp,ai=false){{
  // cooldowns & stun
  me.stun=Math.max(0,me.stun-dt); me.cd=Math.max(0,me.cd-dt);
  // movement
  let vx=0;
  if(inp.left) vx-=me.speed;
  if(inp.right) vx+=me.speed;
  me.x = Math.max(state.arena.left, Math.min(state.arena.right, me.x + vx*dt));
  // gravity
  me.vy += GRAV*dt; me.y += me.vy*dt;
  if(me.y >= state.arena.ground){{ me.y = state.arena.ground; me.vy=0; me.onGround=true; }}
  // actions
  if(inp.block) doBlock(me);
  else if(me.stun<=0 && me.cd<=0){{ if(inp.kick) doKick(me,op); else if(inp.punch) doPunch(me,op); }}
  if(inp.jump) doJump(me);
  // AI
  if(ai){{ // simple CPU
    const d = dist(me,op);
    const want = 88;
    if(d > want+6) {{ me.x += Math.sign(op.x-me.x)*me.speed*0.6*dt; }}
    else if(d < want-6) {{ me.x -= Math.sign(op.x-me.x)*me.speed*0.6*dt; }}
    if(me.cd<=0){{ if(Math.random()<0.02 && inKick(me,op)) doKick(me,op); else if(Math.random()<0.04 && inPunch(me,op)) doPunch(me,op); }}
    if(op.action==='punch'||op.action==='kick'){{ if(Math.random()<0.04) doBlock(me); }}
    if(Math.random()<0.007 && me.onGround) doJump(me);
  }}
}}

let last=performance.now();
function loop(now){
  const dt=Math.min((now-last)/1000,0.033); last=now; state.t+=dt;
  faceEach(p1,p2);
  step(p1,p2,dt,input,false);
  step(p2,p1,dt,{},true);
  // draw
  ctx.clearRect(0,0,canvas.width,canvas.height); drawArena(); drawFighter(p1,'#6ea8ff'); drawFighter(p2,'#fba163');
  hp1.style.width=p1.hp+'%'; hp2.style.width=p2.hp+'%';
  requestAnimationFrame(loop);
} requestAnimationFrame(loop);
</script>
</body></html>
